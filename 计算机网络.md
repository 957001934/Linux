# 计算机网络

> 参考文献：图解TCP/IP，计算机网络-自顶向下方法，计算机网络（谢希仁）

## TCP与UDP

### 传输层的作用

负责控制连接的建立、断开、保持等管理工作

##### 通信处理

TCP/IP的众多应用层协议大多是以C/S形式运行的，服务端的程序有必要先运行，这些服务端程序在UNIX系统中叫做守护进程，如httpd，sshd。在UNIX中并不需要逐一启动，只需要启动一个超级守护进程（inetd），它在收到客户端请求后会去创建（fork)新的进程并转换（exec)为sshd等各种守护进程。

### TCP与UDP 的区分

TCP是面向连接的可靠的流协议，流表示不间断的数据结构，提供可靠传输，实现顺序控制或重发控制、流量控制、拥塞控制等功能

##### UDP的特点

不可靠的数据报协议，不确保消息可达，应用层有时候会根据自己的需要进行重发。适用于高速传输、实时性强的通讯或广播。基于广播的协议如RIP、SNMP、DHCP协议都依赖于UDP。

UDP没有复杂的控制，它只提供传输层最基本的功能，将部分控制转移给应用程序自己去处理。

### 端口号

端口号在传输层中表地址，表示应用程序对外通信的通道，根据端口号来识别应用。可以通过`netstst -n`查看TCP/UDP的网络连接状态。范围1-65535
端口号的分配一部分是固定的，叫做知名端口号，其余由操作系统动态分配和管理
端口与传输协议并没有固定关系，只要端口一致就交给同一程序进行处理，如53可用于TCP和UDP的DNS服

## 应用层

### Telnet协议

telnet利用TCP的一条连接，主机A使用telnet客户端通过这条连接向主机B的telnet守护进程，然后发送命令，命令传输到B端，就仿佛A在直接使用B端的shell。常用端口23，通过`telnet 172.16.20.20` 远程连接主机，可以通过`telnet 主机号 TCP端口号` 来指定端口号。

经常用于登录路由器或高性能交换机等设备，登陆时无须输入密码就可以发送，有危险。有两种模式，一是行模式，输入一行命令发送一行命令，二是透明模式，每输入一个字符发送一个字符。

### SSH协议

Secure Shell(SSH) 是专为远程登录和其他网络服务提供安全性的协议，能够进行数据加密，传输的数据都经过压缩，能够加快传输的速度。可以预防DNS欺骗

##### 安全机制

采用非对称加密技术（RSA）加密了所有传输的数据，提供两种验证方法，基于口令的安全验证和基于密钥的安全验证。

1. 口令登录

   `ssh 客户端用户名@服务器ip地址` 

   默认端口22，也可更改端口

   第一次登录远程主机会提示远程主机的真实性无法确定，并给出公钥指纹，确认后会将远程主机加入已知主机列表。

2. 公钥登录

   `ssh-keygen -t rsa   *#-t表示类型选项，这里采用rsa加密算法*`

   先在本机生成密钥对

   `ssh-copy-id ldz@192.168.0.1` 

   再将公钥复制到远程主机中

### FTP协议

####  工作机制

建立两条TCP连接，一条用于控制，一条用于数据（文件）传输，FTP控制用于完成用户名密码验证、发送请求与应答等，不用于数据传输，通常使用21端口，在控制连接上进行文件GET、PUT、LIST等操作，每次都会建立一个用于数据传输的TCP，传输完成后断掉。数据传输FTP通常使用20端口，

### SMTP协议（Simple Mail Transfer Protocol)

为了实现邮件的高效传递，传输层采用了TCP协议，如今的互联网邮件传输都是通过邮件服务器当作邮差来完成，从邮件服务器到接收端使用POP3（Post Office Protocol)协议。根据邮箱的@后来判断邮件服务商，由DNS中的mail exchange记录完成邮件服务器地址的映射。

SMTP通过建立TCP连接，并在这个连接上进行控制和应答以及数据的发送。通常是25端口。他支持发送端主机的行为，而不是根据接收端的请求发送邮件。

早期的邮件只能发送文本格式，但是现在的邮件通过MIME可以实现图像、声音、程序的数据传输。

**POP**是一种用于客户端接收电子邮件的协议，他根据POP协议从POP服务器中获取邮件。支持用户验证。

**IMAP** 实现邮件在服务器端的管理，使用IMAP可以使得不必从服务器上下载所有邮件也可以阅读，并完成已读/未读的邮件分类，使得人们连接到IMAP服务器后就像连接到本地客户端一样可以自由的管理邮件。

