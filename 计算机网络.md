# 计算机网络

> 参考文献：图解TCP/IP，计算机网络-自顶向下方法，计算机网络（谢希仁）

## TCP与UDP

### 传输层的作用

负责控制连接的建立、断开、保持等管理工作

##### 通信处理

TCP/IP的众多应用层协议大多是以C/S形式运行的，服务端的程序有必要先运行，这些服务端程序在UNIX系统中叫做守护进程，如httpd，sshd。在UNIX中并不需要逐一启动，只需要启动一个超级守护进程（inetd），它在收到客户端请求后会去创建（fork)新的进程并转换（exec)为sshd等各种守护进程。

### TCP与UDP 的区分

##### TCP的特点

TCP是面向连接的可靠的流协议，流表示不间断的数据结构，提供可靠传输，实现顺序控制或重发控制、流量控制、拥塞控制等功能

##### UDP的特点

不可靠的数据报协议，不确保消息可达，应用层有时候会根据自己的需要进行重发。适用于高速传输、实时性强的通讯或广播。基于广播的协议如RIP、SNMP、DHCP协议都依赖于UDP。

UDP没有复杂的控制，它只提供传输层最基本的功能，将部分控制转移给应用程序自己去处理。

### 端口号

端口号在传输层中表地址，表示应用程序对外通信的通道，根据端口号来识别应用。可以通过`netstst -n`查看TCP/UDP的网络连接状态。范围1-65535

端口号的分配一部分是固定的，叫做知名端口号，其余由操作系统动态分配和管理

端口与传输协议并没有固定关系，只要端口一致就交给同一程序进行处理，如53可用于TCP和UDP的DNS服

## 应用层

### Telnet协议

telnet利用TCP的一条连接，主机A使用telnet客户端通过这条连接向主机B的telnet守护进程，然后发送命令，命令传输到B端，就仿佛A在直接使用B端的shell。常用端口23，通过`telnet 172.16.20.20` 远程连接主机，可以通过`telnet 主机号 TCP端口号` 来指定端口号。

经常用于登录路由器或高性能交换机等设备，登陆时无须输入密码就可以发送，有危险。有两种模式，一是行模式，输入一行命令发送一行命令，二是透明模式，每输入一个字符发送一个字符。

### SSH协议

Secure Shell(SSH) 是专为远程登录和其他网络服务提供安全性的协议，能够进行数据加密，传输的数据都经过压缩，能够加快传输的速度。可以预防DNS欺骗

##### 安全机制

采用非对称加密技术（RSA）加密了所有传输的数据，提供两种验证方法，基于口令的安全验证和基于密钥的安全验证。

1. 口令登录

   `ssh 客户端用户名@服务器ip地址` 

   默认端口22，也可更改端口

   第一次登录远程主机会提示远程主机的真实性无法确定，并给出公钥指纹，确认后会将远程主机加入已知主机列表。

2. 公钥登录

   `ssh-keygen -t rsa   *#-t表示类型选项，这里采用rsa加密算法*`

   先在本机生成密钥对

   `ssh-copy-id ldz@192.168.0.1` 

   再将公钥复制到远程主机中

### FTP协议

####  工作机制

建立两条TCP连接，一条用于控制，一条用于数据（文件）传输，FTP控制用于完成用户名密码验证、发送请求与应答等，不用于数据传输，通常使用21端口，在控制连接上进行文件GET、PUT、LIST等操作，每次都会建立一个用于数据传输的TCP，传输完成后断掉。数据传输FTP通常使用20端口，

### SMTP协议（Simple Mail Transfer Protocol)

为了实现邮件的高效传递，传输层采用了TCP协议，如今的互联网邮件传输都是通过邮件服务器当作邮差来完成，从邮件服务器到接收端使用POP3（Post Office Protocol)协议。根据邮箱的@后来判断邮件服务商，由DNS中的mail exchange记录完成邮件服务器地址的映射。

SMTP通过建立TCP连接，并在这个连接上进行控制和应答以及数据的发送。通常是25端口。他支持发送端主机的行为，而不是根据接收端的请求发送邮件。

早期的邮件只能发送文本格式，但是现在的邮件通过MIME可以实现图像、声音、程序的数据传输。

**POP**是一种用于客户端接收电子邮件的协议，他根据POP协议从POP服务器中获取邮件。支持用户验证。

**IMAP** 实现邮件在服务器端的管理，使用IMAP可以使得不必从服务器上下载所有邮件也可以阅读，并完成已读/未读的邮件分类，使得人们连接到IMAP服务器后就像连接到本地客户端一样可以自由的管理邮件。

### HTTP协议

保持连接(keep-alive)：http1.0每一个命令和应答都触发一次TCP连接的建立与断开，http1.1允许一个TCP连接上发送多个命令和应答。

GET,POST,PUT,DELETE是http请求报文的常见命令，分别对应对网络资源的查，改，增，删。GET通常用于获取/查询信息，POST通常用于更新信息。其实对资源的增删查改都可以通过GET/POST完成，不需要用到PUT/DELETE。实质上GET与POST的差别只是发送机制的不同，并不是代表一个取一个发。

[GET与POST的区别](https://www.cnblogs.com/hyddd/archive/2009/03/31/1426026.html)

* GET会将请求的数据附在URL之后，以？分隔，以&连接参数，然后基于base64加密；POST会将提交的数据放置在HTTP包的包体中，因此POST更加安全。
* GET提交的数据有限，并不是HTTP的限制，而是来自浏览器的限制，POST没有大小限制。

**CGI** 是web服务器调用外部程序时所使用的一种服务端应用的规范，引入CGI后客户端请求WEB服务端时会触发服务器运行另外一个程序，客户端输入的数据也会传入这个程序，程序将生成新的HTML和其他数据并返回客户端。

**SNMP** 是使用在TCP/IP的网络管理中的用于收集信息的协议，用于检查网络拥堵、设备异常、修改设置

**RMON** 用于监控信息的传输，负载，地点，用于网络监控和收集网络拓展，判断网络是否被充分利用。

实时多媒体通信中采用UDP，但只使用UDP还不足以达到进行实时多媒体通信的目的，还需要**H.32.**与**SIP协议**，**RTP**协议和压缩技术。

**H.323** 是由ITU开发的用于在IP网传输音频的协议。UDP是一种会发生丢包和乱序的不可靠协议，因此需要**RTP**来进行报文发送时间的管理，它为每个UDP报文附加时间戳和序号。

## 网络安全基础

### 防火墙

包括专门过滤（不过滤）特定数据包的包过滤防火墙，数据道道应用后由应用处理并拒绝非法访问的应用网关。例如路由器中设置只向特定地址和端口发包的包过滤防火墙。

**IDS** （入侵检测系统）检查已经侵入内部网络进行非法访问的情况，并通知网络管理员，具有定期采集日志，长期监控，通知异常等功能。**DMZ**（非军事化区）是内网服务器建立的专门与互联网直接通信的专用子网，从而将内外网分隔开。

**PKI** （公钥基础结构），公钥信息用于加密数据，用户可以通过CA颁发的数字证书验证通信对方的真实性，数字证书中包含身份信息、用户公钥信息及数字签名等，被用于加密邮件和HTTPS通信中。

### 加密技术基础

**对称加密**：加密和解密使用相同的密钥。速度快，但密钥管理困难。加密方式包括：AES、DES

**公钥加密**：加密和解密过程中分别使用公钥和私钥的方式。密钥管理简单，速度慢。加密方式包括：RSA、DH、椭圆曲线加密

![对称加密与公钥加密](https://github.com/957001934/Linux-Tutorial/blob/main/photostore/%E5%AF%B9%E7%A7%B0%E5%8A%A0%E5%AF%86%E4%B8%8E%E5%85%AC%E9%92%A5%E5%8A%A0%E5%AF%86.png)

通过邮件发送，web公开，PKI分配等方式传输密钥。

### 安全协议

**VPN** (虚拟专用网)，采用加密技术和认证技术构造的一个虚拟的私有网络。构造VPN时最常用的就是**IPsec**，它是指在IP首部后面追加ESP和AH，从而实现对此后的数据的加密。

#### SSL/TLS与HTTPS

**SSL**(Secure Socket Layer)是专门用于保护通信的，位于可靠的TCP/IP协议和应用层之间的协议，通过相互认证、数字签名、加密来保证通信的安全性，包括SSL记录协议和SSL握手协议。

**TLS** 是基于SSL上的一种最新版协议，区别主要在于所支持的加密算法不同。

HTTPS采用对称加密方式，而对称加密采用的密钥，采用公钥加密方式进行发送。即web服务器给web客户端发送电子证书（经过CA的私钥加密）和公钥，web客户端将证书使用CA的公钥解密，确认公钥后，使用web服务器的公钥进行加密后发送。

![HTTPS通信方式](https://github.com/957001934/Linux-Tutorial/blob/main/photostore/HTTPS.png)

